; ***************************************************************************
; ***************************************************************************
; ***************************************************************************
; **                                                                       **
; ** ENDINGHI.ASM                                                   MODULE **
; **                                                                       **
; ** End-of-Game.                                                          **
; **                                                                       **
; ** Last modified : 27 May 1999 by John Brandwood                         **
; **                                                                       **
; ** N.B. MUST BE IN SAME BANK AS BITMAPHI.ASM                             **
; **                                                                       **
; ***************************************************************************
; ***************************************************************************
; ***************************************************************************


		INCLUDE	"equates.equ"

;		SECTION	"endinghi",CODE,BANK[$3F]
		section $3f

;
;
;



; ***************************************************************************
; * BoardFinish ()                                                          *
; ***************************************************************************
; *                                                                         *
; ***************************************************************************
; * Inputs      None                                                        *
; *                                                                         *
; * Outputs     None                                                        *
; *                                                                         *
; * Preserved   None                                                        *
; ***************************************************************************

BoardFinish::	LD	A,BACKUP_NONE		;Save the current game state.
		LD	[wWhichGame],A		;
		CALL	SaveBackup		;

		LD	A,[wStructGastn+PLYR_FLAGS]
		OR	A
		JP	Z,MultiFinish

		JP	StoryFinish



; ***************************************************************************
; * MultiFinish ()                                                          *
; ***************************************************************************
; *                                                                         *
; ***************************************************************************
; * Inputs      None                                                        *
; *                                                                         *
; * Outputs     None                                                        *
; *                                                                         *
; * Preserved   None                                                        *
; ***************************************************************************

MultiFinish::	LD	HL,TblMultiWin		;Locate the winning player's
		LD	A,[wWhichPlyr]		;win sequence.
		ADD	A			;
		ADD	L			;
		LD	L,A			;
		JR	NC,.Skip0		;
		INC	H			;
.Skip0:		LD	A,[HLI]			;
		LD	H,[HL]			;
		LD	L,A			;

		CALL	TalkingHeads		;Run that sequence.

		JP	AbortGame		;Reset the game.

;
;
;

TblMultiWin::	DW	MultiWinBeast
		DW	MultiWinBelle
		DW	MultiWinPotts
		DW	MultiWinLumir



; ***************************************************************************
; ***************************************************************************
; ***************************************************************************
;  END OF ENDINGHI.ASM
; ***************************************************************************
; ***************************************************************************
; ***************************************************************************

